```markdown
# Project Name

Hardware-Accelerated System for Kinematic Inverse Solution Based on LeRobot
基于LeRobot的运动学逆解硬件加速系统

## Overview

本系统是2025年FPGA创新与系统设计大赛AMD赛道的作品，该作品对初赛阶段所使用的Cholesky算子进行了深度集成与应用扩展。

具身智能是制造业未来发展的重要方向，而机械臂控制作为其基础环节，涉及如何驱动机械臂从当前位姿运动至目标位姿。该过程需要通过位姿差值求解各关节舵机应旋转的角度，即运动学逆解问题。为此，我们自主设计了运动学逆解IP核，部署于PYNQ-Z2板卡的PL端，充分利用其高度并行计算能力，实现对逆解过程的硬件加速。

在优化策略上，我们在应用PIPELINE与UNROLL等基础优化方法的同时，借鉴了先前在Cholesky算子硬件加速中积累的优化经验，充分挖掘板卡的运算潜力。经对比测试，优化后的逆解算子运行于PL端时，平均每步迭代速度相较于纯软件（全部在PS端执行）提升约37倍。

本项目的海报和流程图如下：

This system is an entry for the AMD track of the 2025 FPGA Innovation and System Design Competition. It features deep integration and application expansion of the Cholesky operator used in the preliminary round.

Embodied intelligence represents a crucial future direction for manufacturing. As a foundational component, robotic arm control involves driving the arm from its current pose to a target pose. This process requires solving the inverse kinematics problem by calculating the rotation angles for each joint servo through pose interpolation. To achieve this, we independently designed an inverse kinematics IP core deployed on the PL side of the PYNQ-Z2 board, fully leveraging its high-parallel computing capabilities to accelerate the inverse solution process via hardware.

In terms of optimization strategy, while applying fundamental techniques like PIPELINE and UNROLL, we drew upon optimization experience accumulated from previous hardware acceleration of the Cholesky operator to fully tap the computational potential of the board. Comparative testing revealed that when the optimized inverse solution operator runs on the PL side, the average iteration speed per step improves by approximately 37 times compared to pure software execution (entirely on the PS side).

The poster and flowchart for this project are as follows:

![Poster](others/poster.png)
![Flowchart](others/flowchart.png)

## Project Structure

Hardware-Accelerated_System_for_IK_Solution_Based_on_LeRobot/   #项目名称
├── notebook
│   ├── design_1.bit   #比特流文件
│   ├── design_1.hwh   #硬件描述文件
│   ├── Dual_Arm_TCP_Receiver.ipynb  #遥操双臂笔记本
│   ├── LM_SingleStep_Benchmark.ipynb  #单步逆解性能测试笔记本
│   ├── SO101_Hardware_IK_Demo.ipynb   #完整逆解性能测试笔记本
│   ├── SO101_IK_HW_vs_Python.ipynb    #硬件加速逆解与Python软件逆解性能对比笔记本
│   └── test_results     #结果图
│       ├── benchmark_hw_vs_py.png
│       ├── ik_repeat_test.png
│       ├── ik_solver_comparison.png
│       ├── ik_solver_distribution.png
│       ├── lm_scaling_benchmark.png
│       └── lm_single_step_benchmark.png
├── others
│   ├── driver     #舵机驱动和配置文件
│   │   ├── ftservo_controller.py
│   │   ├── ftservo_driver.py
│   │   ├── __init__.py
│   │   ├── left_arm.json
│   │   └── right_arm.json
│   ├── flowchart.png
│   ├── hw_solver_wrapper.py  #逆解器构造顶层文件
│   ├── ik                    #逆解器构造底层文件
│   │   ├── base.py
│   │   ├── et.py
│   │   ├── __init__.py
│   │   ├── robot.py
│   │   ├── solvers.py
│   │   └── utils.py
│   ├── joycon_robotics       #joycon驱动
│   ├── poster.png
│   └── TCP.py                #TCP client（PC端）脚本
├── README.md
└── src
├── ik_solver_hls                #硬件逆解器HLS实现代码
│   ├── description.json         #内核描述文件
│   ├── hls_config.cfg           #HLS 配置文件
│   ├── lm_solver_so101.hpp      #逆解器实现头文件
│   ├── tb.cpp                   #testbench
│   ├── vitis-comp.json
│   ├── xf_solver_L1.hpp         #Vitis L1库头文件
│   └── xf_solver_lm_so101.cpp   #硬件逆解器实现代码
└── overlay
├── design_1.tcl                 #bolck design构建脚本
└── ik.tcl                       #vivado构建脚本

## Hardware Requirements

- 目标 PYNQ 板型号：PYNQ-Z2
- 其他硬件要求：一对JoyCon手柄、一台拥有蓝牙与网口的电脑、一对5自由度的机械臂（包含舵机、舵机驱动板和结构件）

## Software Requirements

- PYNQ 版本：PYNQ-Z2
- 其他依赖库：FeeTech舵机驱动driver.ftservo、IK逆解函数ik.robot, ik.utils, ik.solvers, ik.et、顶层函数hw_solver_wrapper

## Getting Started

### 快速开始步骤

1. 将手柄和电脑通过蓝牙连接，将电脑和板卡通过千兆网口连接，将板卡与舵机驱动板有线连接
2. 将notebook文件夹,driver文件夹，ik文件夹以及hw_solver_wrapper.py上传到 PYNQ-Z2 板卡
3. 打开 Jupyter Notebook
4. 运行notebook子文件夹下的ipynb笔记本

## Performance

经过对比测试发现，相比于纯软件（算法完全在PS端执行），经过硬件加速的逆解算法在PL端并行执行时，单个求解循环平均迭代次数减少约4.7倍，平均迭代时间减少约7.9倍，吞吐率增加约9.2倍，平均执行时间降低9.3倍，整体加速比为2.5倍。具体性能对比的图表数据见notebook/test_results，也能够通过运行notebook/目录下的若干ipynb笔记本得到性能数据。

## References

[1] Wei Liu，PYNQ中文资料，https://github.com/louisliuwei/PynqDocs?tab=readme-ov-file
[2] Wei Liu，FPGA并行编程，https://github.com/sazczmh/pp4fpgas-cn/tree/master
[3] AMD,Inc，Vitis 高层次综合用户指南(UG1399)-HLS编程指南，https://docs.amd.com/r/en-US/ug1399-vitis-hls/HLS-Programmers-Guide
[4] https://github.com/huggingface/lerobot
[5] https://github.com/box2ai-robotics/joycon-robotics
```